<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>651 BSG Registration Form</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Show inline error messages
    function showError(input, message) {
      let errorSpan = input.parentElement.querySelector(".error");
      if (!errorSpan) {
        errorSpan = document.createElement("span");
        errorSpan.className = "error text-red-600 text-sm";
        input.parentElement.appendChild(errorSpan);
      }
      errorSpan.textContent = message;
    }

    function clearError(input) {
      const errorSpan = input.parentElement.querySelector(".error");
      if (errorSpan) errorSpan.textContent = "";
    }

    async function handleSubmit(event) {
      event.preventDefault();
      const submitBtn = document.getElementById("submitBtn");
      submitBtn.disabled = true;
      submitBtn.textContent = "Submitting...";

      const form = event.target;
      const formData = new FormData(form);

      let valid = true;
      form.querySelectorAll("[required]").forEach((input) => {
        if (!input.value.trim()) {
          showError(input, "This field is required");
          valid = false;
        } else {
          clearError(input);
        }
      });
      if (!valid) {
        submitBtn.disabled = false;
        submitBtn.textContent = "Submit";
        return;
      }

      // Convert files to Base64
      async function fileToBase64(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => resolve(reader.result.split(",")[1]);
          reader.onerror = reject;
          reader.readAsDataURL(file);
        });
      }

      const allocationFile = formData.get("allocation");
      const idCardFile = formData.get("idCard");

      const payload = {
        title: formData.get("title"),
        fullName: formData.get("fullName"),
        company: formData.get("company"),
        businessType: formData.get("businessType"),
        employees: formData.get("employees"),
        address: formData.get("address"),
        email: formData.get("email"),
        mobile: formData.get("mobile"),
        home: formData.get("home"),
        date: formData.get("date"),
        duration: formData.get("duration"),
      };

      if (allocationFile && allocationFile.size > 0) {
        payload.file = await fileToBase64(allocationFile);
        payload.fileName = allocationFile.name;
        payload.mimeType = allocationFile.type;
      }

      if (idCardFile && idCardFile.size > 0) {
        payload.idCard = await fileToBase64(idCardFile);
        payload.idFileName = idCardFile.name;
        payload.idMime = idCardFile.type;
      }

      try {
        const response = await fetch("https://script.google.com/macros/s/AKfycbxcUCgdxPwH86FXp7MYxSTVoy7TTwrjj-Q7JkE-lDttdec0cdnlgxhSSbeX69mthAkLUw/exec", // replace with your Apps Script /exec URL
          {
            method: "POST",
            body: JSON.stringify(payload),
            headers: { "Content-Type": "application/json" },
          }
        );
        const result = await response.json();
        alert(result.message || "Form submitted!");
        form.reset();
      } catch (err) {
        alert("Error: " + err.message);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "Submit";
      }
    }
  </script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
  <div class="bg-white p-8 rounded-2xl shadow-lg w-full max-w-2xl">
    <!-- Logo -->
    <div class="flex justify-center mb-6">
      <img src="https://via.placeholder.com/120x60.png?text=Logo" alt="Company Logo" class="h-16 object-contain" />
    </div>

    <h1 class="text-2xl font-bold mb-6 text-center">651 BSG Registration Form</h1>

    <form onsubmit="handleSubmit(event)" class="space-y-4">
      <div>
        <label class="block mb-1">Title *</label>
        <select name="title" required class="w-full border rounded-lg p-3 bg-gray-100">
          <option value="">Select</option>
          <option>Mr</option>
          <option>Mrs</option>
          <option>Miss</option>
          <option>Dr</option>
          <option>Chief</option>
        </select>
      </div>

      <div>
        <label class="block mb-1">Full Name *</label>
        <input name="fullName" type="text" required class="w-full border rounded-lg p-3 bg-gray-100" />
      </div>

      <div>
        <label class="block mb-1">Company / Business Name *</label>
        <input name="company" type="text" required class="w-full border rounded-lg p-3 bg-gray-100" />
      </div>

      <div>
        <label class="block mb-1">Type of Business *</label>
        <input name="businessType" type="text" required class="w-full border rounded-lg p-3 bg-gray-100" />
      </div>

      <div>
        <label class="block mb-1">Number of Employees *</label>
        <input name="employees" type="number" required class="w-full border rounded-lg p-3 bg-gray-100" />
      </div>

      <div>
        <label class="block mb-1">Business Address *</label>
        <input name="address" type="text" required class="w-full border rounded-lg p-3 bg-gray-100" />
      </div>

      <div>
        <label class="block mb-1">Email *</label>
        <input name="email" type="email" required class="w-full border rounded-lg p-3 bg-gray-100" />
      </div>

      <div>
        <label class="block mb-1">Mobile</label>
        <input name="mobile" type="tel" class="w-full border rounded-lg p-3 bg-gray-100" />
      </div>

      <div>
        <label class="block mb-1">Home Address *</label>
        <input name="home" type="text" required class="w-full border rounded-lg p-3 bg-gray-100" />
      </div>

      <div>
        <label class="block mb-1">Date of Registration *</label>
        <input name="date" type="date" required class="w-full border rounded-lg p-3 bg-gray-100" />
      </div>

      <div>
        <label class="block mb-1">Duration *</label>
        <select name="duration" required class="w-full border rounded-lg p-3 bg-gray-100">
          <option value="">Select</option>
          <option>6 Months</option>
          <option>1 Year</option>
          <option>2 Years</option>
          <option>3 Years</option>
          <option>5 Years</option>
          <option>10 Years</option>
        </select>
      </div>

      <div>
        <label class="block mb-1">Upload Allocation Letter (Max 10MB) *</label>
        <input name="allocation" type="file" required accept=".pdf,.jpg,.jpeg,.png" class="w-full border rounded-lg p-3 bg-gray-100" />
      </div>

      <div>
        <label class="block mb-1">Upload ID Card / Means of Identification (Max 10MB) *</label>
        <input name="idCard" type="file" required accept=".pdf,.jpg,.jpeg,.png" class="w-full border rounded-lg p-3 bg-gray-100" />
      </div>

      <!-- Buttons -->
      <div class="flex flex-col items-center">
        <button type="reset" 
          class="w-1/2 mb-3 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600">
          Reset
        </button>

        <!-- Divider -->
        <div class="w-full border-t border-gray-300 my-2"></div>

        <button id="submitBtn" type="submit" 
          class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700">
          Submit
        </button>
      </div>
    </form>
  </div>
</body>
</html>
